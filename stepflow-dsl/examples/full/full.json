{
  "comment": "Full integration workflow example",
  "version": "1.0.0",
  "startAt": "PrepareTask",
  "states": {
    "PrepareTask": {
      "type": "Task",
      "resource": "log.input",
      "inputMapping": {
        "preserve": "none",
        "mappings": [
          { "key": "x", "type": "constant", "value": 1 },
          { "key": "y", "type": "constant", "value": 2 },
          {
            "key": "sum",
            "type": "expr",
            "transform": "input.x + input.y",
            "dependsOn": ["x", "y"]
          }
        ]
      },
      "next": "DecidePath"
    },
    "DecidePath": {
      "type": "Choice",
      "choices": [
        {
          "condition": {
            "variable": "$.sum",
            "operator": "GreaterThan",
            "value": 3
          },
          "next": "MapLoop"
        }
      ],
      "default": "FailState"
    },
    "MapLoop": {
      "type": "Map",
      "itemsPath": "$.items",
      "iterator": {
        "startAt": "PassEach",
        "states": {
          "PassEach": {
            "type": "Pass",
            "resultPath": "$.result",
            "next": "SucceedInMap"
          },
          "SucceedInMap": { "type": "Succeed" }
        }
      },
      "next": "ParallelBranch"
    },
    "ParallelBranch": {
      "type": "Parallel",
      "branches": [
        {
          "startAt": "ParallelOne",
          "states": {
            "ParallelOne": {
              "type": "Task",
              "resource": "log.parallel.1",
              "end": true
            }
          }
        },
        {
          "startAt": "ParallelTwo",
          "states": {
            "ParallelTwo": {
              "type": "Task",
              "resource": "log.parallel.2",
              "end": true
            }
          }
        }
      ],
      "next": "SuccessFinal"
    },
    "SuccessFinal": {
      "type": "Succeed"
    },
    "FailState": {
      "type": "Fail",
      "error": "ValueTooLow",
      "cause": "The sum was less than or equal to 3"
    }
  }
}